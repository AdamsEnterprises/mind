<template name="Motion.ListComponent">
  {{#if discussionExists}}
    <div class="section">
      {{#each motions}}
        {{> Motion.ListItemComponent}}
      {{else}}
        <div class="row">
          <div class="col s12 center-align grey-text">
            No motion has been proposed yet.
          </div>
        </div>
      {{/each}}
    </div>
    {{> Motion.NewComponent}}
  {{/if}}
</template>

<template name="Motion.ListItemComponent">
  <div class="card">
    {{#if $and canEdit isBeingEdited}}
      <form class="motion-edit">
        <div class="card-content">
          <div class="input-field">
            <textarea name="body" id="edit-motion-body" class="materialize-textarea" required>{{body}}</textarea>
            <label for="edit-motion-body">Motion</label>
          </div>
        </div>
        <div class="card-action">
          <div class="center-align">
            <button class="motion-edit-save waves-effect waves-light btn-flat" type="submit"><i class="material-icons left">done</i>Save</button>
            <button class="motion-edit-cancel waves-effect waves-light btn-flat" type="button"><i class="material-icons left">cancel</i>Cancel</button>
          </div>
        </div>
      </form>
    {{else}}
      <div class="card-content">
        <p>{{body}}</p>
      </div>
      {{#if $and isOpen canVote}}
        <div class="card-action">
          {{> Motion.VoteComponent}}
        </div>
      {{/if}}
      {{#if $or canOpen canClose canWithdraw canEdit}}
        <div class="card-action">
          <div class="center-align">
            {{#if canOpen}}
              <button class="open-voting waves-effect waves-light btn-flat" type="button"><i class="material-icons left">play_arrow</i>Open voting</button>
            {{/if}}
            {{#if canClose}}
              <button class="close-voting waves-effect waves-light btn-flat" type="button"><i class="material-icons left">stop</i>Close voting</button>
            {{/if}}
            {{#if canWithdraw}}
              <button class="withdraw-motion waves-effect waves-light btn-flat" type="button"><i class="material-icons left">delete</i>Withdraw</button>
            {{/if}}
            {{#if canEdit}}
              <button class="edit-motion waves-effect waves-light btn-flat" type="button"><i class="material-icons left">edit</i>Edit</button>
            {{/if}}
          </div>
        </div>
      {{else}}
        {{#unless $or isOpen isClosed isWithdrawn}}
          <div class="card-action center-align grey-text">
            Voting is not yet open.
          </div>
        {{/unless}}
        {{#if $and isOpen ($not canVote)}}
          <div class="card-action center-align grey-text sign-in-action">
            {{! TODO: Here we are assuming that if you cannot vote, you have to sign in. This might not be the case with custom roles. }}
            Voting is open. <a href="{{pathFor 'Account.signIn'}}">Sign in</a> to vote.
          </div>
        {{/if}}
      {{/if}}
      {{#if isClosed}}
        <div class="card-action">
          <div class="center-align">Motion {{#if motionPassed}}<span class="result passed">passed</span>{{else}}<span class="result failed">failed</span>{{/if}}.</div>
          {{> Motion.TallyComponent}}
        </div>
      {{/if}}
      {{#if isWithdrawn}}
        <div class="card-action center-align grey-text">
          Motion has been withdrawn.
        </div>
      {{/if}}
    {{/if}}
  </div>
</template>

<template name="Motion.TallyComponent">
  <div class="tally-chart ct-major-twelfth"></div>
  <div class="tally-stats grey-text">
    <small class="stats-item">Votes: {{tally.votesCount}}</small>
    <small class="stats-item">Abstentions: {{tally.abstentionsCount}}</small>
    <small class="stats-item">Confidence: {{round tally.confidenceLevel}}</small>
    <small class="stats-item">Tally: {{round tally.result}}</small>
  </div>
</template>