<template name="Discussion.CloseComponent">
  {{#if notFound}}
    {{> NotFoundComponent}}
  {{else}}
    {{#if canClose}}
      <div class="section discussion">
        <div class="row">
          <h4 class="col s12">
            {{> ExpandableButton}}{{discussion.title}}
          </h4>
        </div>
        {{#if discussion.descriptionDisplay}}
          <div class="row">
            <div class="col s12 trix-content">
              {{! Remember to sanitize content in all codepaths which allow users to provide this content. }}
              {{{discussion.descriptionDisplay}}}
            </div>
          </div>
        {{/if}}
        {{#if isExpanded}}
          <div class="row expansion">
            <div class="col s12">
              <div class="divider"></div>
              {{#with discussion}}
                {{> MetadataComponent args editButton='Discussion.EditButton'}}
              {{/with}}
            </div>
          </div>
        {{/if}}
      </div>
      {{#if subscriptionsReady}}
        {{#with discussion}}
          {{> Discussion.CloseFormComponent}}
        {{/with}}
      {{/if}}
    {{else}}
      {{> AccessDeniedComponent}}
    {{/if}}
  {{/if}}
</template>

<template name="Discussion.CloseFormComponent">
  {{#if canBeClosed}}
    <div class="section close-motions">
      <div class="row">
        <form class="col s12" onSubmit>
          <div class="row">
            <div class="input-field col s12">
              {{> EditorComponent args name='closingNote' id=($join '-' 'close-discussion-closing-note' _id) label='Closing note'}}
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <label class="active">Passing motions</label>
              {{#each motions}}
                <input type="checkbox" id="discussion-close-{{_id}}" name="passingMotions" value="{{_id}}" />
                <label for="discussion-close-{{_id}}" class="left"></label>
                {{> Motion.ListItemComponent args noExtraMetadataButtons=true}}
              {{else}}
                <p>
                  No motion has been proposed.
                </p>
              {{/each}}
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12 center-align">
              <button type="submit" class="btn waves-effect waves-light"><i class="material-icons left">send</i>Close discussion</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  {{else}}
    <div class="section">
      <div class="row">
        <div class="col s12">
          <div class="center-align error card-panel">
            {{!-- Other combinations are not possible because the form is displayed only if canClose is true. --}}
            {{#if $eq status STATUS.MOTIONS}}
              Discussion cannot be closed because there are motions still being drafted.
              Withdraw them or conclude voting on them.
            {{/if}}
            {{#if $eq status STATUS.VOTING}}
              Discussion cannot be closed because there are motions which are still open for voting.
            {{/if}}
          </div>
        </div>
      </div>
    </div>
  {{/if}}
</template>
